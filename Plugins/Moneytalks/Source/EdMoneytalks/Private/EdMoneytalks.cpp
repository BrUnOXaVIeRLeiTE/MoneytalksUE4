/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////
//			Copyright 2021 (C) Bruno Xavier Leite
//////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "EdMoneytalks.h"

#include "EdMoneytalksStyle.h"
#include "EdMoneytalks_Shared.h"

#include "Moneytalks.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#define LOCTEXT_NAMESPACE "Moneytalks"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void FEMoneytalks::StartupModule() {
	FEMoneytalksStyle::Initialize();
	FEMoneytalksStyle::ReloadTextures();
	//
	{
		FPropertyEditorModule &PropertyEditorModule = FModuleManager::LoadModuleChecked<FPropertyEditorModule>("PropertyEditor");
		PropertyEditorModule.RegisterCustomPropertyTypeLayout("Decimal",FOnGetPropertyTypeCustomizationInstance::CreateStatic(&FDecimal_CustomDetails::MakeInstance));
	}
}

void FEMoneytalks::ShutdownModule() {
	FEMoneytalksStyle::Shutdown();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// FDecimal

TSharedRef<IPropertyTypeCustomization> FDecimal_CustomDetails::MakeInstance() {
	return MakeShareable(new FDecimal_CustomDetails());
}

void FDecimal_CustomDetails::CustomizeHeader(TSharedRef<IPropertyHandle>StructPropertyHandle, FDetailWidgetRow &HeaderRow, IPropertyTypeCustomizationUtils &StructCustomizationUtils) {
	HeaderRow
	.NameContent()
	[
		SNew(SHorizontalBox)
		.ToolTipText(LOCTEXT("FDecimalTooltip","Decimal (not supported by property viewer)"))
		+SHorizontalBox::Slot()
			.VAlign(VAlign_Center)
			.Padding(0,0,5,0)
			.AutoWidth()
			[
				SNew(SImage)
				.Image(FEMoneytalksStyle::Get().GetBrush("ClassIcon.Decimal"))
			]
		+SHorizontalBox::Slot()
		.VAlign(VAlign_Center)
		[
			SNew(STextBlock)
			.Font(IDetailLayoutBuilder::GetDetailFont())
			.Text(StructPropertyHandle->GetPropertyDisplayName())
		]
	];
}

void FDecimal_CustomDetails::CustomizeChildren(TSharedRef<class IPropertyHandle> StructPropertyHandle, class IDetailChildrenBuilder &StructBuilder, IPropertyTypeCustomizationUtils &StructCustomizationUtils) {}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#undef LOCTEXT_NAMESPACE

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

IMPLEMENT_MODULE(FEMoneytalks,EdMoneytalks)

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////